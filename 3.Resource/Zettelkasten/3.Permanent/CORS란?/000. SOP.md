### SOP란?
> [!success] 기본
> - Same-Origin Policy, 동일 출처 정책
> - 같은 출처에서만 리소스를 공유할 수 있다.

<u>웹 보안 모델의 기본 정책</u>이자 핵심 개념 중 하나이며, **출처가 다른 리소스에 대한 직접 요청을 제한**
- 특정한 웹 페이지에 포함된 JavaScript가 다른 출처에 속한 데이터에 접근하지 못하도록 제한
#### 출처(Origin)
- **출처는 프로토콜 + 호스트 + 포트**의 조합으로 결정된다.
	- 예를 들어, `https://mydomain.com/app`과 `https://mydomain.com/api`는 동일 출처
	- 반면, `http://mydomain.com/app`과 `https://mydomain.com/app`은 다른 출처
#### 예외
- 예외적으로 다음과 같은 경우에만 다른 출처의 리소스 접근을 차단하지 않는다.
	- `<img>`: 다른 도메인에 대한 이미지 파일 요청은 차단되지 않는다.
	- `<link>`: 다른 도메인에 대한 CSS 요청은 차단되지 않는다.
	- `<script>`: 다른 도메인에 대한 JS 파일 요청은 차단되지 않는다.
	- `<form>`: `action` 속성 값으로 출처가 다른 URL을 사용할 수 있다.
	  즉, 다른 출처로 폼 데이터를 전송하는 것은 차단되지 않는다.
	  반면, 태그 내에서 `XMLHttpRequest` 또는 `fetch` API를 사용하는 경우에는 차단된다.
	- [[001. CORS|CORS]] 정책을 준수하는 경우
---
### SOP가 없다면?
>악의적인 피싱 사이트가 다른 웹 사이트의 데이터에 무단으로 접근하는 형태로 문제가 발생할 수 있다.
#### Case 1. CSRF
1. 사용자가 A 은행(`https://a-bank.com`)에 로그인한 상태에서 실수로 피싱 사이트(`https://malicious.com`)에 접속
2. 피싱 사이트는 로그인된 상태를 이용하여 A 은행에 해커의 계좌로 송금을 요청
3. SOP가 없어 피싱 사이트가 A 은행에 데이터 요청이 가능하므로, 송금은 정상적으로 처리됨
	1. SOP가 있다면, 피싱 사이트에서 A 은행에 직접 요청 보낼 수 없도록 차단됨
4. 결과적으로 사용자는 자기도 모르는 사이에 해커의 계좌로 송금하게 된다!
#### Case2. 세션 하이재킹
1. 사용자가 `https://private.com`에 로그인하고, 이후 인증을 쿠키로 유지하는 상태에서 실수로 피싱 사이트(`https://malicious.com`)에 접속
2. 피싱 사이트의 JavaScript에 의해 `https://private.com/user-info`와 같은 민감한 데이터가 유출
	1. SOP가 있다면 피싱 사이트에서 `https://private.com`의 데이터에 접근할 수 없음
3. 피싱 사이트의 JavaScript에 의해 2.의 민감한 데이터를 해커에게 전송
4. 결과적으로 사용자는 자기도 모르는 사이에 민감한 정보가 유출된다!

때문에 SOP는 사용자의 로그인 정보를 보호하고, 악의적인 피싱사이트가 민감한 데이터에 접근하는 것을 방지하고자 고안되었다.

---
### 너무 완고한 SOP
> SOP는 보안에 있어 필수적이지만, 너무 제한적이다!

현대적인 웹 애플리케이션은 FE와 BE를 별도의 도메인으로 나누어 운용하는 경우가 많기에, **서로 다른 도메인의 리소스에 접근해야할 일이 발생할 수 밖에** 없다. 애초에 웹이라는 환경 자체가 다른 출처의 리소스에 접근할 일이 굉장히 많다!
때문에 SOP의 제한을 완화하면서도 최대한의 보안을 유지할 유연한 방법이 필요해졌으며, 이에 '어떠한 규칙을 모두 준수하는 요청은 허용하는' 예외 정책인 [[001. CORS|CORS]]가 제안되었다. 다시 말해, <u>CORS를 준수하지 않는다면 다른 출처의 리소스를 사용할 수 없다</u>.